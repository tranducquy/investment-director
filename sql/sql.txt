
-- strategy summary
SELECT
 count(symbol) as 件数
,strategy
,start_date
,end_date
,avg(win_rate) * avg(expected_rate_per_1day) as 平均勝率×一日当たりの期待損益率平均
,avg(rate_of_return) as 平均騰落率
,avg(win_rate) as 平均勝率
,avg(trading_period) as 平均取引日数
,avg(expected_rate) as 平均期待損益率
,avg(expected_rate_per_1day) as 一日当たりの期待損益率平均
,avg(long_expected_rate) as 平均期待損益率long
,avg(long_expected_rate_per_1day) as 一日当たりの期待損益率平均long
,avg(short_expected_rate) as 平均期待損益率short
,avg(short_expected_rate_per_1day) as 一日当たりの期待損益率平均short
,avg(average_period_per_trade) as 取引当たりの平均日数
,avg(win_count+loss_count) as 平均取引数
from backtest_result
where start_date = '2018-08-01'
group by strategy, start_date, end_date
having count(symbol) > 1000
order by 10 desc
;


--個別銘柄
SELECT
 symbol
,strategy
,start_date
,end_date
,rate_of_return as 騰落率
,win_rate as 勝率
,trading_period as 取引日数
,expected_rate as 期待損益率
,expected_rate_per_1day as 一日当たりの期待損益率
,long_expected_rate as 期待損益率long
,long_expected_rate_per_1day as 一日当たりの期待損益率long
,long_win_count+long_loss_count as 取引数long
,short_expected_rate as 期待損益率short
,short_expected_rate_per_1day as 一日当たりの期待損益率short
,short_win_count+short_loss_count as 取引数short
,average_period_per_trade as 取引当たりの日数
,win_count+loss_count as 取引数
from backtest_result
where 0 = 0
and symbol = '5401.T'
and regist_date = '2019-08-12'
order by start_date, rate_of_return desc
;


-- 抽出
   select
     symbol
    ,strategy
    ,regist_date
    ,rate_of_return
    ,expected_rate
    ,expected_rate_per_1day
    ,average_period_per_trade
    ,win_rate
    from backtest_result
    where 
    (symbol||strategy) in (
        select 
         symbol||strategy
        from backtest_result
        where (symbol||strategy) in (
            select
             symbol||strategy
            from backtest_result
            where (symbol||strategy) in (
                select
                 symbol||strategy
                from backtest_result
                where start_date = '2019-05-12'
				and end_date = '2019-08-11'
                and backtest_period > 20*3
                and rate_of_return > 0
            )
            and start_date = '2018-08-12'
			and end_date = '2019-08-11'
            and backtest_period > 300*1
            and rate_of_return > 0
        )
        and start_date = '2016-08-12'
        and end_date = '2019-08-11'
        and backtest_period > 300*3
        and rate_of_return > 0
    ) 
    and start_date = '2004-08-12'
    and end_date = '2019-08-11'
    and backtest_period > 300*15
    and rate_of_return > 0
    order by rate_of_return desc
;




